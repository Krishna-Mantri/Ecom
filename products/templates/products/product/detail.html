{% extends "base.html" %}

{% block title %}
{{ product.name }}
{% endblock %}

{% block content %}
<div class="container mx-auto p-8">

    <!-- Product Detail Section -->
    <div class="flex flex-col lg:flex-row space-x-8">

        <!-- Product Image Section -->
        <div class="w-full lg:w-1/2 mb-6 lg:mb-0">
            {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-auto rounded-lg shadow-md object-cover">
            {% else %}
            <p class="text-center text-gray-500">Image not available</p>
            {% endif %}
        </div>

        <!-- Product Information Section -->
        <div class="w-full lg:w-1/2 p-6 bg-white rounded-lg shadow-lg space-y-6">
            <h3 class="text-3xl font-semibold text-gray-800">{{ product.name }}</h3>
            <h3 class="text-2xlxl font-semibold text-gray-800">Category: {{ product.category }}</h3>
            <p class="text-lg text-gray-600">Description: {{ product.description }}</p>
            
            <!-- Price Section -->
            <p class="text-2xl font-bold text-indigo-600">INR {{ product.price }}/-</p>

            <!-- Add to Cart Button -->
            <form action="{% url 'cart:cart_add' product.id %}" method="post" id="add-to-cart-form">
                {% csrf_token %}
                <button type="submit" class="w-full py-3 px-6 bg-indigo-600 text-white font-semibold rounded-md shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition duration-300">
                    Add to Cart
                </button>
            </form>

            <!-- Error/Success Message -->
            <p id="message" class="text-center text-sm mt-2"></p>
        </div>

    </div>

</div>

<script>
    document.getElementById('add-to-cart-form').addEventListener("submit", function(event) {
        event.preventDefault();

        const form = event.target;
        const url = form.action;
        const formData = new FormData(form);

        fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const messageElement = document.getElementById('message');
            if (data.success) {
                messageElement.textContent = data.message;
                messageElement.classList.add('text-green-500');
                messageElement.classList.remove('text-red-500');
            } else {
                messageElement.textContent = "Failed to add to cart.";
                messageElement.classList.add('text-red-500');
                messageElement.classList.remove('text-green-500');
            }
        })
        .catch(error => {
            console.error("Error", error);
            const messageElement = document.getElementById('message');
            messageElement.textContent = "An error occurred, please try again.";
            messageElement.classList.add('text-red-500');
            messageElement.classList.remove('text-green-500');
        });
    });
</script>
{% endblock %}
